<html>

<head>
    <script src="https://unpkg.com/htmx.org@2.0.3"></script>
    <script>
        var crsr
        function updateCursorPos(c, term) {
            if (c != null) {
                term.removeChild(c)
            }
            term.appendChild(t)
        }
        function flashCursor(c) {
            setInterval(() => { c.classList.toggle("hidden") }, 500)
        }
        function add(term, text) {
            term.removeChild(crsr)
            term.innerHTML = term.innerHTML + text
            term.appendChild(crsr)
            h = document.body.scrollHeight
            y = scrollY
            document.body.scrollTo(y, h)
        }
        window.onload = (event) => {
            crsr = document.createElement("div")
            crsr.id = "cursor"
            crsr.textContent = "â–ˆ"
            flashCursor(crsr)
            var term = document.querySelector("#terminal")
            term.appendChild(crsr)
            var buff = ""
            document.addEventListener("keypress", f)

            function f(x) {
                var k = x.key
                console.log("[" + k + "]")
                if (k == "Enter") {
                    fetch("/input", {
                        method: "POST",
                        headers: { "content-type": "application/x-www-form-urlencoded" },
                        body: `data="${buff}"`
                    }); //submit user input
                    add(term, "\n")
                    buff = ""; //reset buffer
                }
                else {
                    buff += k
                    add(term, k)
                }
            }
        }
    </script>
    <style>
        body {
            background-color: black;
            color: white;
            color: light-dark;
        }

        #cursor {
            border: none;
            display: inline-block;
        }

        #cursor.hidden {
            color: black;
        }

        #terminal {
            border: solid salmon;
            caret-color: white;
            color: white;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <label for="terminal">client.c</label>
    <pre id="terminal" hx-trigger="every 2s" hx-get="/read" hx-swap="beforeend">
    </pre>
    <div id="end"></div>
</body>

</html>